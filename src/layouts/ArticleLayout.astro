---
import BaseLayout from './BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ShareButtons from '../components/ShareButtons.astro';
import { format } from 'date-fns';
import type { CollectionEntry } from 'astro:content';
import { getAuthorBySlug } from '../data/authors';

interface Props {
  article: CollectionEntry<'articles'>;
}

const { article } = Astro.props;
const { title, subtitle, excerpt, author: authorSlug, publishedAt, category, imageUrl, imageAlt, imageCredit } = article.data;
const author = getAuthorBySlug(authorSlug);
const formattedDate = format(publishedAt, 'MMMM d, yyyy');

// Calculate reading time (rough estimate)
const content = await article.render();
const wordCount = article.body?.split(/\s+/).length || 0;
const readingTime = Math.ceil(wordCount / 200);

// Full article URL for sharing
const articleUrl = `https://banishinggradients.com/article/${article.slug}`;
---

<BaseLayout
  title={title}
  description={excerpt}
  articleSlug={article.slug}
  type="article"
  publishedTime={publishedAt}
  author={author?.name}
>
  <Header />

  <main class="flex-1">
    <article class="max-w-3xl mx-auto px-4 py-8">
      <!-- Category -->
      <div class="mb-4">
        <a href={`/category/${category.toLowerCase().replace(/\s+/g, '-')}`} class="category-badge hover:underline">
          {category}
        </a>
      </div>

      <!-- Headline -->
      <h1 class="article-headline-large mb-4">{title}</h1>

      {subtitle && (
        <p class="text-xl text-gray-600 mb-6 leading-relaxed">{subtitle}</p>
      )}

      <!-- Meta -->
      <div class="flex flex-wrap items-center gap-2 text-sm text-gray-500 mb-6 pb-6 border-b">
        <a href="/contributors" class="font-medium text-gray-700 hover:underline">{author?.name || authorSlug}</a>
        {author?.title && <span class="text-gray-400">({author.title})</span>}
        <span class="mx-1">·</span>
        <time datetime={publishedAt.toISOString()}>{formattedDate}</time>
        <span class="mx-1">·</span>
        <span>{readingTime} min read</span>
      </div>

      <!-- Featured Image -->
      {imageUrl && (
        <figure class="mb-8">
          <img
            src={imageUrl}
            alt={imageAlt || title}
            class="w-full h-auto"
            loading="eager"
          />
          {imageCredit && (
            <figcaption class="text-sm text-gray-500 mt-2 italic">
              Photo: {imageCredit}
            </figcaption>
          )}
        </figure>
      )}

      <!-- Article Content -->
      <div class="article-content">
        <slot />
      </div>

      <!-- Share Buttons -->
      <div class="mt-8 pt-6 border-t border-gray-200">
        <ShareButtons title={title} url={articleUrl} description={excerpt} />
      </div>
    </article>
  </main>

  <Footer />
</BaseLayout>
