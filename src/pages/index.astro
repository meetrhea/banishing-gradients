---
export const prerender = true;

import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ArticleCard from '../components/ArticleCard.astro';
import { getCollection } from 'astro:content';

const allArticles = await getCollection('articles');
const sortedArticles = allArticles.sort(
  (a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf()
);

const featuredArticle = sortedArticles.find(a => a.data.featured) || sortedArticles[0];
const secondaryArticles = sortedArticles.filter(a => a !== featuredArticle).slice(0, 3);
const sidebarArticles = sortedArticles.filter(a => a !== featuredArticle && !secondaryArticles.includes(a)).slice(0, 5);
---

<BaseLayout title="Home">
  <Header />

  <main class="flex-1">
    <div class="container mx-auto px-4 py-8">
      <!-- Main Grid Layout -->
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <!-- Main Content Area -->
        <div class="lg:col-span-8">
          <!-- Featured Article -->
          {featuredArticle && (
            <div class="border-b-2 border-gray-200 pb-8 mb-8">
              <ArticleCard article={featuredArticle} variant="featured" />
            </div>
          )}

          <!-- Secondary Articles Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {secondaryArticles.map((article) => (
              <div class="border-b border-gray-200 pb-6">
                <ArticleCard article={article} variant="standard" />
              </div>
            ))}
          </div>
        </div>

        <!-- Sidebar -->
        <aside class="lg:col-span-4">
          <div class="sticky top-4">
            <!-- More Headlines -->
            <div class="bg-gray-50 p-4 mb-6">
              <h3 class="text-lg font-bold mb-4 pb-2 border-b-2 accent-border" style="font-family: 'Playfair Display', Georgia, serif;">
                More Headlines
              </h3>
              <div>
                {sidebarArticles.map((article) => (
                  <ArticleCard article={article} variant="compact" showImage={false} />
                ))}
              </div>
            </div>

            <!-- Quick Links / Ad Placeholder -->
            <div class="bg-gray-900 text-white p-6 text-center">
              <p class="text-sm uppercase tracking-wider mb-2">Subscribe</p>
              <p class="text-xs text-gray-400 mb-4">Get the finest AI satire delivered to your feed reader</p>
              <a
                href="/rss.xml"
                class="inline-block px-4 py-2 accent-bg text-sm font-medium hover:opacity-90 transition-opacity"
              >
                RSS Feed
              </a>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <Footer />
</BaseLayout>
